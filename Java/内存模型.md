# 内存模型
## JMM（Java Memory Model）
java内存模型，是一种符合内存模型规范的，屏蔽了各种硬件和操作系统的访问差异的，保证了Java程序在各种平台下对内存的访问都能保证效果一致的机制及规范；

java多线程之间是通过共享内存进行通信，而多线程之间进行通信的共享内存又称为主内存，其中每个线程又维护一个自己的本地内存；

JMM主要是控制本地内存和主内存之间的数据交互；

## JVM (Java Virtual Machine)

java虚拟机，java虚拟机运行时内存区域结构包括【计栈本堆区】：

- 计：PC寄存器（程序计数器）(Program Counter Register)
- 栈：Java虚拟机栈(Java Virtual Machine stacks)【栈由栈帧构成（对应被调用方法）】
    - 局部变量表（Local Variables）:存储方法中的局部变量（声明非静态变量和形参），编译器确定大小，运行时大小不会发生变化
    - 操作数栈（Operand Stack）：需要执行的指令
    - 执行当前方法所属类的运行时常量池引用
    - 方法返回地址（Return Address）
- 本：本地方法栈(Native Method Stacks)：为执行本地方法服务（Native Method）
- 堆：Java堆(Java Heap)：存储对象本身和数组（所有线程共享）
- 区：方法区（Method Area），内含运行时常量池（Run-Time Constant Pool）：线程共享区域，在方法区中存储了每个类的信息（类名，方法信息，字段信息），静态变量，常量以及编译后代码

另外还有：所有线程共享的数据区域，每个线程独享的数据区域，运行的常量

### JVM优化

- 开启JVM大页内存（页表寄存缓存器TLB），增加虚拟地址和物理地址映射，减少CPU的TLB miss（类似三级缓存提前加载，不用去内存中寻找）：-XX:LargePageSizeInBytes=10m 【1.5之前需要加XX:+UseLargePages】
- 软引用和弱引用提升JVM内存性能:
    - 【强引用】只要引用存在，垃圾回收器永远不会工作；
    - 【软引用】非必须引用，内存溢出之前进行回收
    - 【弱引用】用在回调函数中防止内存泄露
    - 【虚引用】垃圾回收时回收，无法通过引用取到对象值
